# 全志H616学习

## 基础学习

详细的基础学习文档参考目录下的H616学习文档pdf

## 内容补充

需要确定GPIO引脚方位，蓝牙芯片对面的最靠近直角位置的针脚为3.3V

### Vim的缩进

~~~
sudo vim /etc/vim/vimrc

set nu
set tabstop=4
set shiftwidth=4
~~~

链接的shell脚本
~~~bash
gcc $1 -lwiringPi -lwiringPiDev -lpthread -lm -lcrypt -lrt
~~~
可以通过./build xxx.c来执行.c文件

需要确定GPIO引脚方位，蓝牙芯片对面的最靠近直角位置的针脚为3.3V



### 自动连接wifi

1. **连接到WiFi**：

   ```bash
   sudo nmcli dev wifi connect "YourSSID" password "YourPassword"
   ```

2. **设置该连接为自动连接**：

   ```bash
   sudo nmcli connection modify "YourSSID" connection.autoconnect yes
   ```

   这样，每次开机时，`NetworkManager`会自动尝试连接到指定的WiFi

如果想连接新的wifi ，删除旧的wifi就可以了，然后再次执行1，2

```
nmcli connection delete "YourSSID"
```

开机启动配置：

**`rc.local`**：

- 用于系统启动完成后执行初始化任务。
- 以 root 权限运行。
- 需要确保文件具有可执行权限。
- 在 systemd 系统中可能需要手动启用。

**`/etc/profile.d/`**：

- 用于用户登录时初始化环境变量和启动某些应用程序。
- 适用于登录 shell。
- 脚本按字母顺序执行。
- 提供了模块化的配置方式，便于维护。

### 编译流程

在使用 C 语言编写程序并调用外部库（如 SQLite）时，整个编译过程一般分为两个主要阶段：编译和链接。

- **编译阶段**：编译器（如 `gcc`）会把源文件（`.c` 文件）转化为目标文件（`.o` 文件）。在这个阶段，编译器会对代码进行语法检查、词法分析等操作，生成对应的机器码。
- **链接阶段**：链接器会把多个目标文件以及所需的库文件组合起来，生成一个可执行文件。链接器的主要任务是解析符号引用，把目标文件中未定义的符号和库文件中定义的符号进行匹配和关联。

 `-lsqlite3` **参数的作用**

`-lsqlite3` 是 `gcc` 编译器的一个链接选项，其作用是告诉链接器在链接过程中要链接 SQLite 库。具体来说，`-l` 是链接选项的前缀，后面跟着的 `sqlite3` 是库名。链接器会根据这个库名去查找对应的库文件。

#### 链接流程

- 确定库文件的搜索路径

链接器有默认的库文件搜索路径，常见的默认搜索路径包括 `/lib`、`/usr/lib`、`/usr/local/lib` 等。此外，你还可以通过 `-L` 选项来指定额外的库文件搜索路径。例如：

```bash
gcc your_program.c -o your_program -L/custom/lib -lsqlite3
```

这里的 `-L/custom/lib` 就是指定链接器在 `/custom/lib` 目录中搜索库文件。

- 查找库文件

链接器会根据 `-lsqlite3` 指定的库名，在搜索路径中查找对应的库文件。在 Linux 系统中，动态链接库的文件名通常遵循 `lib<库名>.so` 的命名规则，静态链接库的文件名通常遵循 `lib<库名>.a` 的命名规则。所以，对于 `sqlite3` 库，链接器会查找 `libsqlite3.so`（动态链接库）或 `libsqlite3.a`（静态链接库）。

#### lib的区别

在 Linux 系统中，`/lib`、`/usr/lib` 和 `/usr/local/lib` 这三个目录都用于存放库文件，但它们在用途、内容来源和管理方式上存在一些区别，下面为你详细介绍：

`/lib`

- **用途**：该目录主要存放系统启动和运行时所需的最基本的共享库文件。这些库文件对于系统的正常运行至关重要，是系统启动过程中最早被加载和使用的库。
- **内容来源**：通常包含系统核心库，例如 C 标准库（`libc.so`）、动态链接器（`ld-linux.so`）等。这些库是操作系统的基础组成部分，由系统安装包管理工具（如 `apt`、`yum` 等）进行管理和维护。
- **管理方式**：一般由系统级别的软件包管理工具进行更新和维护，用户不建议手动修改该目录下的文件，以免影响系统的稳定性和正常运行。

`/usr/lib`

- **用途**：此目录用于存放系统级别的应用程序和服务所需的共享库文件。这些库文件支持系统中各种软件的运行，但并非系统启动所必需的。
- **内容来源**：包含了大量的系统自带软件和第三方软件依赖的库文件。例如，图形界面相关的库、网络服务相关的库等。这些库文件通常是在安装系统软件包或第三方软件时自动安装到该目录下的。
- **管理方式**：同样由系统的软件包管理工具进行管理和维护。当你使用软件包管理工具安装、升级或卸载软件时，相关的库文件会自动在该目录下进行相应的操作。

`/usr/local/lib`

- **用途**：该目录主要用于存放用户自行安装的软件和库文件。当你从源代码编译安装软件，或者手动下载并安装第三方库时，通常会将这些库文件安装到 `/usr/local/lib` 目录下。
- **内容来源**：包含用户自定义安装的软件所需的库文件，这些软件可能不是系统默认安装的，或者是用户为了满足特定需求而额外安装的。例如，用户自己编译安装的某个开发库、特定版本的数据库驱动等。
- **管理方式**：由用户自己负责管理和维护。当你安装新的软件或库时，需要确保将其正确安装到该目录下；当需要卸载某个软件时，也需要手动删除该软件在 `/usr/local/lib` 目录下的相关库文件。

### 刷新动态链接库

```bash
sudo ldconfig
```

明明/usr/local/lib下有安装好的sqlite3的库文件，但是识别不到，这时候需要刷新动态链接库

### sqlite3_exec

```c
sqlite3_exec(sqlite3*, const char *sql, sqlite_callback, void *data, char **errmsg)
```

1. `sqlite3 *db`：
   - 这是一个指向 `sqlite3` 对象的指针，代表已经打开的数据库连接句柄。这个句柄是通过调用 `sqlite3_open` 函数获取的，后续对数据库的操作都要基于这个连接。
2. `const char *sql`：
   - 这是一个指向以 null 结尾的字符串指针，里面包含了要执行的 SQL 语句。可以是单条 SQL 语句，也可以是多条 SQL 语句（多条语句之间用分号 `;` 分隔）。
3. `int (*callback)(void*,int,char**,char**)`：
   - 这是一个回调函数指针。当执行的 SQL 语句是查询语句（如 `SELECT`）时，==**每查询到一行数据**==，就会调用一次这个回调函数。如果执行的 SQL 语句不是查询语句（如 `INSERT`、`UPDATE`、`DELETE` 等），则不需要回调函数，此时可以将该参数设置为 `NULL`。
   - 回调函数的原型如下：

```c
int callback(void *data, int argc, char **argv, char **azColName);
```

- 参数解释：
  - `void *data`：这是用户通过 `sqlite3_exec` 函数的 `data` 参数传递给回调函数的数据。
  - `int argc`：表示当前查询结果行的列数。
  - `char **argv`：这是一个字符串数组，每个元素对应查询结果行的一个列值。
  - `char **azColName`：这也是一个字符串数组，每个元素对应查询结果列的列名。
- 回调函数的返回值：**如果回调函数返回 0，表示继续处理下一行数据；如果返回非 0 值，则会停止处理后续数据。**

1. `void *data`：
   - 这是一个通用指针，用于传递用户自定义的数据给回调函数。当回调函数需要使用一些额外的数据时，可以通过这个参数传递。如果不需要传递额外数据，可以将该参数设置为 `NULL`。
2. `char **errmsg`：
   - 这是一个指向字符指针的指针，用于存储执行 SQL 语句时产生的错误信息。如果执行过程中出现错误，`sqlite3_exec` 函数会分配内存并将错误信息存储在这个指针指向的位置。使用完错误信息后，需要调用 `sqlite3_free` 函数释放这块内存。
